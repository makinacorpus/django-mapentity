sudo: required
dist: bionic
language: python

python:
- 3.6
- 3.7
- 3.8

env:
  matrix:
   - DJANGO_VERSION=2.2.*
   - DJANGO_VERSION=3.1.*

install:
- >
  sudo apt-get -y install libproj-dev binutils gdal-bin libgdal-dev 
  libsqlite3-mod-spatialite
  iproute2 fonts-liberation
  libcairo2 libffi-dev libfreetype6-dev libgdk-pixbuf2.0-dev
  libpango1.0-0 libpangocairo-1.0-0 libssl-dev libxml2-dev libxslt-dev
  software-properties-common libffi-dev
- pip install .[dev]
- pip install codecov
- if [[ $DJANGO_VERSION == dev ]]; then
  pip install -e git+https://github.com/django/django@master#egg=django;
  else
  pip install Django==$DJANGO_VERSION -U; fi

after_failure:
- pip freeze

script:
- coverage run ./manage.py test
- coverage run --include="mapentity/*" manage.py test

after_success:
  - codecov

jobs:
  allow_failures:
    - env: DJANGO_VERSION=dev

  include:
  - stage: lint
    install:
    - pip install flake8
    before_script: skip
    script:
    - flake8 geostore test_geostore
    after_success: skip
